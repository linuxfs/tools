#include <errno.h>
#include <fcntl.h>
#include <stdio.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <unistd.h>

#define FILES "dammy"

off_t msize()
{
	struct stat st;
	stat(FILES, &st);
	return st.st_size;
}

int main(void)
{
	int fd, i, operr, mode[4];
	char buf[16], *prin[4];

	mode[0] = O_RDWR | O_CREAT;
	mode[1] = O_RDWR | O_CREAT | O_TRUNC;
	mode[2] = O_RDWR | O_CREAT | O_TRUNC | O_EXCL;
	mode[3] = O_RDWR | O_CREAT |           O_EXCL;
	prin[0] = "O_CREAT                   ";
	prin[1] = "O_CREAT | O_TRUNC         ";
	prin[2] = "O_CREAT | O_TRUNC | O_EXCL";
	prin[3] = "O_CREAT |           O_EXCL";
	errno = 0;

	/* test start */
	for (i=0;i<4;i++) {
		unlink(FILES);
		fd = open(FILES, mode[i], 0644);
		operr = errno;
		errno = 0;
		if (fd > 0) {
			write(fd, &buf, 16);
			close(fd);
		}
		printf("open ENOENT %s %2d %2d %2ld\n", prin[i], fd, operr, msize());
		fd = open(FILES, mode[i], 0644);
		operr = errno;
		errno = 0;
		if (!(fd < 0)) {
			close(fd);
		}
		printf("open EEXIST %s %2d %2d %2ld\n", prin[i], fd, operr, msize());
	}
	return 0;
}
